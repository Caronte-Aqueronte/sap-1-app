<nz-page-header
  nzBackIcon
  [nzGhost]="false"
  class="bg-white border-b border-blue-100"
>
  <nz-page-header-title>
    <span class="inline-flex items-center gap-2">
      <nz-icon
        nzType="calendar"
        nzTheme="outline"
        class="text-[#fb9120]"
      ></nz-icon>
      <span class="font-bold text-gray-900"
        >Reservar Habitacion @if(room){
        {{ room.number }}
        }
      </span>
    </span>
  </nz-page-header-title>
  <nz-page-header-subtitle>
    <span class="text-gray-900">
      Descubre el confort exclusivo de esta habitación y asegura tu estadía
      antes de que se agote
    </span>
  </nz-page-header-subtitle>
</nz-page-header>
<div class="mt-6 flex justify-center">
  @if (room) {
  <div
    class="bg-white shadow-xl rounded-2xl p-8 border border-gray-200 w-full md:w-[75vw]"
  >
    <!-- título + botón reservar -->
    <div class="mb-6 flex items-center justify-between">
      <h2 class="text-2xl font-bold text-[#012e5c]">
        Información de la Habitación
      </h2>

      <button
        nz-button
        nzType="primary"
        (click)="onReserve(room)"
        nzSize="large"
      >
        <span class="flex items-center gap-2">
          <nz-icon nzType="shopping-cart" nzTheme="outline"></nz-icon>
          Reservar
        </span>
      </button>
    </div>

    <!-- detalles -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-y-6 gap-x-12">
      <!-- número -->
      <div>
        <p class="text-sm font-medium text-gray-500">Número</p>
        <p class="text-lg text-gray-900 font-bold">
          {{ room.number }}
        </p>
      </div>

      <!-- precio -->
      <div>
        <p class="text-sm font-medium text-gray-500">Precio por noche</p>
        <p class="text-lg font-extrabold text-[#fb9120]">
          Q {{ room.basePrice }}
        </p>
      </div>

      <!-- fechas seleccionadas y total -->
      @if (checkIn && checkOut) {
      <div>
        <p class="text-sm font-medium text-gray-500">Check-in</p>
        <p class="text-lg text-gray-900 font-bold">{{ displayCheckIn }}</p>
      </div>
      <div>
        <p class="text-sm font-medium text-gray-500">Check-out</p>
        <p class="text-lg text-gray-900 font-bold">{{ displayCheckOut }}</p>
      </div>
      <div>
        <p class="text-sm font-medium text-gray-500">Noches</p>
        <p class="text-lg text-gray-900 font-bold">{{ nights }}</p>
      </div>
      <div>
        <p class="text-sm font-medium text-gray-500">Total</p>
        <p class="text-lg font-extrabold text-[#fb9120]">Q {{ total }}</p>
      </div>
      }

      <!-- divider -->
      <div class="col-span-full">
        <nz-divider nzText="Información del Hotel"></nz-divider>
      </div>

      <!-- hotel -->
      <div>
        <p class="text-sm font-medium text-gray-500">Hotel</p>
        <p class="text-lg font-bold text-gray-900">
          {{ room.hotel.name }}
        </p>
      </div>

      <!-- teléfono -->
      <div>
        <p class="text-sm font-medium text-gray-500">Teléfono</p>
        <p class="text-lg font-semibold text-gray-900">
          {{ room.hotel.phoneNumber }}
        </p>
      </div>
    </div>
  </div>
  }
</div>

<!-- divider -->
<div class="col-span-full">
  <nz-divider nzText="Opiniones De Nuestros Clientes"></nz-divider>
</div>

<!-- lista de reseñas existentes -->
<div class="mt-4 w-full md:w-[75vw] mx-auto">
  @if (reviews.length === 0) {
  <div class="text-gray-500 italic">Sé el primero en opinar.</div>
  } @else {
  <div class="grid grid-cols-1 max-h-[200px] overflow-y-auto pr-2">
    @for (review of reviews; track review.id) {
    <app-review-card [review]="review"></app-review-card>
    }
  </div>
  }
</div>

<!-- sección de comentarios -->
<div
  class="mt-10 mb-10 bg-white shadow-lg rounded-2xl p-8 border border-gray-200 w-full md:w-[75vw] mx-auto"
>
  <h3 class="text-xl font-bold text-[#012e5c] mb-6">Deja tu opinión</h3>

  <form nz-form [formGroup]="commentForm" (ngSubmit)="submitComment()">
    <!-- estrellas -->
    <nz-form-item>
      <nz-form-label [nzSpan]="4">Valoración</nz-form-label>
      <nz-form-control [nzSpan]="20" nzErrorTip="Selecciona tu valoración">
        <nz-rate formControlName="rating"></nz-rate>
      </nz-form-control>
    </nz-form-item>

    <!-- comentario -->
    <nz-form-item>
      <nz-form-label [nzSpan]="4">Comentario</nz-form-label>
      <nz-form-control
        [nzSpan]="20"
        nzErrorTip="El comentario no puede superar los 255 caracteres"
      >
        <textarea
          nz-input
          formControlName="comment"
          rows="3"
          placeholder="Escribe tu comentario (opcional)"
          maxlength="255"
        ></textarea>

        <!-- contador -->
        <div class="text-xs text-gray-500 mt-1 text-right">
          {{ commentForm.get("comment")?.value?.length || 0 }}/255
        </div>
      </nz-form-control>
    </nz-form-item>

    <!-- botón enviar -->
    <nz-form-item>
      <nz-form-control [nzSpan]="24" class="flex justify-end">
        <button nz-button nzType="primary" [disabled]="!commentForm.valid">
          Enviar opinión
        </button>
      </nz-form-control>
    </nz-form-item>
  </form>
</div>
